{{- if .Values.secrets.create }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "code-story.fullname" . }}
  labels:
    {{- include "code-story.labels" . | nindent 4 }}
type: Opaque
stringData:
  {{- if .Values.postgresql.enabled }}
  database-url: "postgresql+asyncpg://{{ .Values.postgresql.auth.username }}:{{ .Values.postgresql.auth.password }}@{{ include "code-story.fullname" . }}-postgresql:5432/{{ .Values.postgresql.auth.database }}"
  {{- else }}
  database-url: "postgresql+asyncpg://{{ .Values.externalDatabase.username }}:{{ .Values.externalDatabase.password }}@{{ .Values.externalDatabase.host }}:{{ .Values.externalDatabase.port }}/{{ .Values.externalDatabase.database }}"
  {{- end }}

  {{- if .Values.redis.enabled }}
  redis-url: "redis://:{{ .Values.redis.auth.password }}@{{ include "code-story.fullname" . }}-redis-master:6379/0"
  celery-broker-url: "redis://:{{ .Values.redis.auth.password }}@{{ include "code-story.fullname" . }}-redis-master:6379/1"
  celery-result-backend: "redis://:{{ .Values.redis.auth.password }}@{{ include "code-story.fullname" . }}-redis-master:6379/2"
  {{- else }}
  redis-url: "redis://:{{ .Values.externalRedis.password }}@{{ .Values.externalRedis.host }}:{{ .Values.externalRedis.port }}/0"
  celery-broker-url: "redis://:{{ .Values.externalRedis.password }}@{{ .Values.externalRedis.host }}:{{ .Values.externalRedis.port }}/1"
  celery-result-backend: "redis://:{{ .Values.externalRedis.password }}@{{ .Values.externalRedis.host }}:{{ .Values.externalRedis.port }}/2"
  {{- end }}

  jwt-secret: {{ .Values.secrets.jwtSecret | quote }}
  anthropic-api-key: {{ .Values.secrets.anthropicApiKey | quote }}
  elevenlabs-api-key: {{ .Values.secrets.elevenLabsApiKey | quote }}
  github-token: {{ .Values.secrets.githubToken | quote }}
  aws-access-key-id: {{ .Values.s3.accessKeyId | quote }}
  aws-secret-access-key: {{ .Values.s3.secretAccessKey | quote }}
  {{- if .Values.supabase.url }}
  supabase-url: {{ .Values.supabase.url | quote }}
  supabase-anon-key: {{ .Values.supabase.anonKey | quote }}
  supabase-service-role-key: {{ .Values.supabase.serviceRoleKey | quote }}
  {{- end }}
{{- end }}
